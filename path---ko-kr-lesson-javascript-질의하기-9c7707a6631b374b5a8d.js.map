{"version":3,"sources":["webpack:///path---ko-kr-lesson-javascript-질의하기-9c7707a6631b374b5a8d.js","webpack:///./.cache/json/ko-kr-lesson-javascript-질의하기.json"],"names":["webpackJsonp","442","module","exports","data","allPostTitles","edges","node","frontmatter","title","lesson","programming_language","chapter","type","fields","slug","postBySlug","html","timeToRead","excerpt","date","tags","pathContext","language"],"mappings":"AAAAA,cAAc,iBAERC,IACA,SAAUC,EAAQC,GCHxBD,EAAAC,SAAkBC,MAAQC,eAAiBC,QAAUC,MAAQC,aAAeC,MAAA,UAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA6FC,QAAWC,KAAA,eAAsBR,MAAQC,aAAeC,MAAA,OAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA0FC,QAAWC,KAAA,YAAmBR,MAAQC,aAAeC,MAAA,YAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA+FC,QAAWC,KAAA,iBAAwBR,MAAQC,aAAeC,MAAA,UAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA6FC,QAAWC,KAAA,eAAsBR,MAAQC,aAAeC,MAAA,aAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAAgGC,QAAWC,KAAA,iBAAwBR,MAAQC,aAAeC,MAAA,WAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA8FC,QAAWC,KAAA,gBAAuBR,MAAQC,aAAeC,MAAA,MAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAAyFC,QAAWC,KAAA,WAAkBR,MAAQC,aAAeC,MAAA,YAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA+FC,QAAWC,KAAA,iBAAwBR,MAAQC,aAAeC,MAAA,qBAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAAwGC,QAAWC,KAAA,yBAAgCR,MAAQC,aAAeC,MAAA,OAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA0FC,QAAWC,KAAA,YAAmBR,MAAQC,aAAeC,MAAA,OAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA0FC,QAAWC,KAAA,YAAmBR,MAAQC,aAAeC,MAAA,UAAAC,OAAA,EAAAC,qBAAA,aAAAC,QAAA,EAAAC,KAAA,UAA6FC,QAAWC,KAAA,gBAAsBC,YAAeC,KAAA;AAAui+BC,WAAA,EAAAC,QAAA,mIAAAX,aAAyXC,MAAA,OAAAW,KAAA,aAAAT,qBAAA,aAAAU,MAAA,iDAA+HP,QAAWC,KAAA,WAAiBO,aAAgBP,KAAA,QAAAJ,qBAAA,aAAAY,SAAA","file":"path---ko-kr-lesson-javascript-질의하기-9c7707a6631b374b5a8d.js","sourcesContent":["webpackJsonp([193746139245226],{\n\n/***/ 442:\n/***/ (function(module, exports) {\n\n\tmodule.exports = {\"data\":{\"allPostTitles\":{\"edges\":[{\"node\":{\"frontmatter\":{\"title\":\"액터 간 통신\",\"lesson\":2,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/액터-간-통신\"}}},{\"node\":{\"frontmatter\":{\"title\":\"시작하기\",\"lesson\":2,\"programming_language\":\"javascript\",\"chapter\":1,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/시작하기\"}}},{\"node\":{\"frontmatter\":{\"title\":\"액터의 계층 구조\",\"lesson\":4,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/액터의-계층-구조\"}}},{\"node\":{\"frontmatter\":{\"title\":\"Nact 소개\",\"lesson\":1,\"programming_language\":\"javascript\",\"chapter\":1,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/nact-소개\"}}},{\"node\":{\"frontmatter\":{\"title\":\"상태 저장(영속성)\",\"lesson\":1,\"programming_language\":\"javascript\",\"chapter\":3,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/상태-저장-영속성\"}}},{\"node\":{\"frontmatter\":{\"title\":\"퍼시스턴트 쿼리\",\"lesson\":4,\"programming_language\":\"javascript\",\"chapter\":3,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/퍼시스턴트-쿼리\"}}},{\"node\":{\"frontmatter\":{\"title\":\"스냅샷\",\"lesson\":2,\"programming_language\":\"javascript\",\"chapter\":3,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/스냅샷\"}}},{\"node\":{\"frontmatter\":{\"title\":\"상태가 있는 액터\",\"lesson\":1,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/상태가-있는-액터\"}}},{\"node\":{\"frontmatter\":{\"title\":\"관리 감독(Supervision)\",\"lesson\":5,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/관리-감독-supervision\"}}},{\"node\":{\"frontmatter\":{\"title\":\"타임아웃\",\"lesson\":3,\"programming_language\":\"javascript\",\"chapter\":3,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/타임아웃\"}}},{\"node\":{\"frontmatter\":{\"title\":\"질의하기\",\"lesson\":3,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/질의하기\"}}},{\"node\":{\"frontmatter\":{\"title\":\"인코더/디코더\",\"lesson\":2,\"programming_language\":\"javascript\",\"chapter\":4,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/인코더-디코더\"}}}]},\"postBySlug\":{\"html\":\"<p>액터 시스템은 닫힌 세계가 아니므로 외부 세계와 소통할 수 있어야 합니다. 일반적으로 액터 시스템은 REST API 혹은 RPC를 통해 외부에 노출됩니다. 그런데 REST나 RPC는 블로킹 스타일로 동작합니다. 즉 Request가 들어와서 처리되고 Response를 회신하는 동안 원래의 연결은 유지됩니다. 논블로킹으로 동작하는 nact와 연결될 수 있도록 <code>query</code> 함수를 제공합니다. <code>query</code> 함수는 <code>Promise</code>를 반환합니다.</p>\\n<p><code>dispatch</code> 함수와 마찬가지로 <code>query</code> 함수는 액터의 메일박스에 메시지를 담습니다. 다른 점은, <code>query</code> 함수는 가상의 액터를 생성해서 (송신자로 참조해서) 메시지를 보내는 것입니다. 이때 이 가상 액터가 응답 메시지를 받으면 <code>query</code> 함수에서 리턴된 Promise에 값이 들어갑니다.</p>\\n<p><code>query</code> 함수는 대상 액터 참조, 메시지와 더불어 timeout 값을 인자로 받습니다. timeout 값의 단위는 밀리 초입니다. 만약 Promise에 값이 들\\b어오는데 이보다 시간이 오래 걸리면, 시간 초과와 함께 Promise는 무효화됩니다. 질의 패턴에서의 시간 제한은 운영 환경에서 매우 중요합니다. 서브 시스템의 실패로 인해 질의가 처리되지 못하게 되면 점점 시스템의 가용 자원을 소모하게 되고, 이는 전체 시스템에 단계적으로 장애를 일으키게 됩니다. timeout은 이런 문제가 발생하지 않도록 해줍니다.</p>\\n<p>이 예제에서, 간단한 단일 사용자용 인-메모리 주소록 시스템을 만들어보겠습니다. 실제감을 더하기 위해 express 애플리케이션을 호스팅하겠습니다. npm(혹은 yarn)을 이용해서 <code>express</code>, <code>body-parser</code>, <code>uuid</code> 그리고 <code>nact</code>를 설치합니다.</p>\\n<blockquote>\\n<p>알림: 이 예제는 이후 장에서 계속 확장할 것입니다.</p>\\n</blockquote>\\n<p>주소록 API의 기본 요건이 어떻게 될까요? 다음과 같은 것들이 될 수 있습니다.</p>\\n<ul>\\n<li>새 연락처 추가</li>\\n<li>모든 연락처 조회</li>\\n<li>특정 연락처 조회</li>\\n<li>연락처 수정</li>\\n<li>연락처 삭제</li>\\n</ul>\\n<p>이를 구현하기 위해 다음의 엔드포인트를 구성합니다.</p>\\n<ul>\\n<li>POST /api/contacts - 새 연락처 추가</li>\\n<li>GET /api/contacts - 모든 연락처 조회</li>\\n<li>GET /api/contacts/:contact_id - 특정 연락처 조회</li>\\n<li>PATCH /api/contacts/:contact_id - 연락처 수정</li>\\n<li>DELETE /api/contacts/:contact_id - 연락처 삭제</li>\\n</ul>\\n<p>아래는 서버 인스턴스와 엔드 포인트를 구성하는 미완성 코드입니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code><span class=\\\"token keyword\\\">import</span> express <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'express'</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token keyword\\\">as</span> bodyParser <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'body-parser'</span>\\n\\n<span class=\\\"token keyword\\\">const</span> app <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">express</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">use</span><span class=\\\"token punctuation\\\">(</span>bodyParser<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">json</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 모든 연락처 조회 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 특정 연락처 조회 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">post</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 새 연락처 추가 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">patch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 연락처 수정 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">delete</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 연락처 삭제 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">listen</span><span class=\\\"token punctuation\\\">(</span>process<span class=\\\"token punctuation\\\">.</span>env<span class=\\\"token punctuation\\\">.</span>PORT <span class=\\\"token operator\\\">||</span> <span class=\\\"token number\\\">3000</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>process<span class=\\\"token punctuation\\\">.</span>env<span class=\\\"token punctuation\\\">.</span>PORT <span class=\\\"token operator\\\">||</span> <span class=\\\"token number\\\">3000</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\"> 포트 수신중!`</span></span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>액터는 메시지 구동 방식으로 동작하므로, 액터 시스템과 REST API 간에 사용할 메시지 타입을 정의합니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code><span class=\\\"token keyword\\\">const</span> ContactProtocolTypes <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n   GET_CONTACTS<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'GET_CONTACTS'</span><span class=\\\"token punctuation\\\">,</span>\\n   GET_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'GET_CONTACT'</span><span class=\\\"token punctuation\\\">,</span>\\n   UPDATE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'UPDATE_CONTACT'</span><span class=\\\"token punctuation\\\">,</span>\\n   REMOVE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'REMOVE_CONTACT'</span><span class=\\\"token punctuation\\\">,</span>\\n   CREATE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'CREATE_CONTACT'</span><span class=\\\"token punctuation\\\">,</span>\\n   \\n   <span class=\\\"token comment\\\">// 성공</span>\\n   SUCCESS<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'SUCCESS'</span><span class=\\\"token punctuation\\\">,</span>\\n   \\n   <span class=\\\"token comment\\\">// 연락처를 찾지 못했을 때</span>\\n   NOT_FOUND<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'NOT_FOUND'</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>연락처 액터는 각 메시지 타입을 처리해야 합니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code><span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> v4 <span class=\\\"token keyword\\\">as</span> uuid <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'uuid'</span>\\n\\n<span class=\\\"token keyword\\\">const</span> contactsService <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">spawn</span><span class=\\\"token punctuation\\\">(</span>\\n  system<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">(</span>state <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">,</span> ctx<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>    \\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>msg<span class=\\\"token punctuation\\\">.</span>type <span class=\\\"token operator\\\">===</span> GET_CONTACTS<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// 모든 연락처를 배열로 반환</span>\\n      <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>\\n        ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> \\n        <span class=\\\"token punctuation\\\">{</span> payload<span class=\\\"token punctuation\\\">:</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">values</span><span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> \\n        ctx<span class=\\\"token punctuation\\\">.</span>self\\n      <span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>msg<span class=\\\"token punctuation\\\">.</span>type <span class=\\\"token operator\\\">===</span> CREATE_CONTACT<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> newContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> id<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token function\\\">uuid</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">...</span>msg<span class=\\\"token punctuation\\\">.</span>payload <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token keyword\\\">const</span> nextState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> \\n        contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>newContact<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> newContact <span class=\\\"token punctuation\\\">}</span> \\n      <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> newContact <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">return</span> nextState\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// 이미 존재하는 연락처가 있는지 확인</span>\\n      <span class=\\\"token keyword\\\">const</span> contact <span class=\\\"token operator\\\">=</span> state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">[</span>msg<span class=\\\"token punctuation\\\">.</span>contactId<span class=\\\"token punctuation\\\">]</span>\\n\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token keyword\\\">switch</span><span class=\\\"token punctuation\\\">(</span>msg<span class=\\\"token punctuation\\\">.</span>type<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token keyword\\\">case</span> GET_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n              <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> payload<span class=\\\"token punctuation\\\">:</span> contact<span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n              <span class=\\\"token keyword\\\">break</span>\\n            <span class=\\\"token punctuation\\\">}</span>\\n            <span class=\\\"token keyword\\\">case</span> REMOVE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n              <span class=\\\"token comment\\\">// 특정 연락처 항목을 undefined로 변경한 새 상태 반환</span>\\n              <span class=\\\"token keyword\\\">const</span> nextState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>contact<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> undefined <span class=\\\"token punctuation\\\">}</span>\\n              <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> contact <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n              <span class=\\\"token keyword\\\">return</span> nextState\\n            <span class=\\\"token punctuation\\\">}</span>\\n            <span class=\\\"token keyword\\\">case</span> UPDATE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n              <span class=\\\"token comment\\\">// 특정 연락처 항목을 덮어 쓴 새 상태 반환</span>\\n              <span class=\\\"token keyword\\\">const</span> updatedContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token operator\\\">...</span>contact<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">...</span>msg<span class=\\\"token punctuation\\\">.</span>payload <span class=\\\"token punctuation\\\">}</span>\\n              <span class=\\\"token keyword\\\">const</span> nextState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> \\n                <span class=\\\"token operator\\\">...</span>state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">,</span>\\n                <span class=\\\"token punctuation\\\">[</span>contact<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> updatedContact \\n              <span class=\\\"token punctuation\\\">}</span>\\n              <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> updatedContact <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n              <span class=\\\"token keyword\\\">return</span> nextState                 \\n            <span class=\\\"token punctuation\\\">}</span>\\n          <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// 기존 연락처가 존재하지 않으면 NOT_FOUND 메시지를 요청자에게 응답</span>\\n        <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>\\n          ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> \\n          <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> NOT_FOUND<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">:</span> msg<span class=\\\"token punctuation\\\">.</span>contactId <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> \\n          ctx<span class=\\\"token punctuation\\\">.</span>self\\n        <span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>      \\n    <span class=\\\"token comment\\\">// 현재 상태에서 변경된 것이 없으면 현재 상태를 그대로 반환</span>\\n    <span class=\\\"token keyword\\\">return</span> state\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">'contacts'</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>이제 주소록 서비스를 API 컨트롤러와 연결합니다. 각 엔드포인트에서 질의 패턴으로 액터에 메시지를 보냅니다.</p>\\n<p>아래는 특정 연락처를 조회하는 엔드포인트에서 액터와 통신하는 예제입니다. (다른 곳도 비슷하게 합니다.)</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code>app<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span> \\n  <span class=\\\"token keyword\\\">const</span> contactId <span class=\\\"token operator\\\">=</span> req<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">.</span>contact_id\\n  <span class=\\\"token keyword\\\">const</span> msg <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> GET_CONTACT<span class=\\\"token punctuation\\\">,</span> contactId <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">query</span><span class=\\\"token punctuation\\\">(</span>contactService<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">250</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token comment\\\">// 타임아웃 250ms 설정</span>\\n    <span class=\\\"token keyword\\\">switch</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">.</span>type<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">case</span> SUCCESS<span class=\\\"token punctuation\\\">:</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">json</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">.</span>payload<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n      <span class=\\\"token keyword\\\">case</span> NOT_FOUND<span class=\\\"token punctuation\\\">:</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">404</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n      <span class=\\\"token keyword\\\">default</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token comment\\\">// 여기에 도달하지는 않을 것임. 무언가 크게 잘못된 경우</span>\\n        console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">error</span><span class=\\\"token punctuation\\\">(</span>JSON<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">500</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 504: 게이트웨이 시간 초과. 타임아웃이 발생할 때만 예외 던짐</span>\\n    res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">504</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>각 엔드포인트를 구현할 때, 반복되는 보일러 플레이트 코드가 많습니다. <code>performQuery</code>라는 별도의 함수를 만들어서 에러 처리 부분을 따로 빼는 방법으로 코드를 리팩터링 할 수 있습니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code><span class=\\\"token keyword\\\">const</span> performQuery <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>msg<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">query</span><span class=\\\"token punctuation\\\">(</span>contactsService<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">500</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token comment\\\">// 타임아웃 250ms 설정</span>\\n    \\n    <span class=\\\"token keyword\\\">switch</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">.</span>type<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">case</span> SUCCESS<span class=\\\"token punctuation\\\">:</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">json</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">.</span>payload<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n      <span class=\\\"token keyword\\\">case</span> NOT_FOUND<span class=\\\"token punctuation\\\">:</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">404</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n      <span class=\\\"token keyword\\\">default</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token comment\\\">// 여기에 도달하지는 않을 것임. 무언가 크게 잘못된 경우</span>\\n        console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">error</span><span class=\\\"token punctuation\\\">(</span>JSON<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">500</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 504: 게이트웨이 시간 초과. 타임아웃이 발생할 때만 예외 던짐</span>\\n    res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">504</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>이로써 API 엔드포인트를 아래와 같이 작성할 수 있습니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code>app<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> GET_CONTACTS <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> \\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> GET_CONTACT<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">.</span>contact_id <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">post</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> CREATE_CONTACT<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>body <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">patch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> \\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> UPDATE_CONTACT<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">.</span>contact_id<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>body <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">delete</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> \\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> REMOVE_CONTACT<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">.</span>contact_id <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>이상으로 간단한 주소록 서비스를 구현해보았습니다.</p>\",\"timeToRead\":4,\"excerpt\":\"액터 시스템은 닫힌 세계가 아니므로 외부 세계와 소통할 수 있어야 합니다. 일반적으로 액터 시스템은 REST API 혹은 RPC를 통해 외부에 노출됩니다. 그런데 REST나 RPC는 블로킹 스타일로 동작합니다. 즉 Request…\",\"frontmatter\":{\"title\":\"질의하기\",\"date\":\"22/03/2019\",\"programming_language\":\"javascript\",\"tags\":[\"getting-started\",\"nact\",\"javascript\",\"nodejs\"]},\"fields\":{\"slug\":\"/질의하기\"}}},\"pathContext\":{\"slug\":\"/질의하기\",\"programming_language\":\"javascript\",\"language\":\"ko_KR\"}}\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// path---ko-kr-lesson-javascript-질의하기-9c7707a6631b374b5a8d.js","module.exports = {\"data\":{\"allPostTitles\":{\"edges\":[{\"node\":{\"frontmatter\":{\"title\":\"액터 간 통신\",\"lesson\":2,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/액터-간-통신\"}}},{\"node\":{\"frontmatter\":{\"title\":\"시작하기\",\"lesson\":2,\"programming_language\":\"javascript\",\"chapter\":1,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/시작하기\"}}},{\"node\":{\"frontmatter\":{\"title\":\"액터의 계층 구조\",\"lesson\":4,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/액터의-계층-구조\"}}},{\"node\":{\"frontmatter\":{\"title\":\"Nact 소개\",\"lesson\":1,\"programming_language\":\"javascript\",\"chapter\":1,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/nact-소개\"}}},{\"node\":{\"frontmatter\":{\"title\":\"상태 저장(영속성)\",\"lesson\":1,\"programming_language\":\"javascript\",\"chapter\":3,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/상태-저장-영속성\"}}},{\"node\":{\"frontmatter\":{\"title\":\"퍼시스턴트 쿼리\",\"lesson\":4,\"programming_language\":\"javascript\",\"chapter\":3,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/퍼시스턴트-쿼리\"}}},{\"node\":{\"frontmatter\":{\"title\":\"스냅샷\",\"lesson\":2,\"programming_language\":\"javascript\",\"chapter\":3,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/스냅샷\"}}},{\"node\":{\"frontmatter\":{\"title\":\"상태가 있는 액터\",\"lesson\":1,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/상태가-있는-액터\"}}},{\"node\":{\"frontmatter\":{\"title\":\"관리 감독(Supervision)\",\"lesson\":5,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/관리-감독-supervision\"}}},{\"node\":{\"frontmatter\":{\"title\":\"타임아웃\",\"lesson\":3,\"programming_language\":\"javascript\",\"chapter\":3,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/타임아웃\"}}},{\"node\":{\"frontmatter\":{\"title\":\"질의하기\",\"lesson\":3,\"programming_language\":\"javascript\",\"chapter\":2,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/질의하기\"}}},{\"node\":{\"frontmatter\":{\"title\":\"인코더/디코더\",\"lesson\":2,\"programming_language\":\"javascript\",\"chapter\":4,\"type\":\"lesson\"},\"fields\":{\"slug\":\"/인코더-디코더\"}}}]},\"postBySlug\":{\"html\":\"<p>액터 시스템은 닫힌 세계가 아니므로 외부 세계와 소통할 수 있어야 합니다. 일반적으로 액터 시스템은 REST API 혹은 RPC를 통해 외부에 노출됩니다. 그런데 REST나 RPC는 블로킹 스타일로 동작합니다. 즉 Request가 들어와서 처리되고 Response를 회신하는 동안 원래의 연결은 유지됩니다. 논블로킹으로 동작하는 nact와 연결될 수 있도록 <code>query</code> 함수를 제공합니다. <code>query</code> 함수는 <code>Promise</code>를 반환합니다.</p>\\n<p><code>dispatch</code> 함수와 마찬가지로 <code>query</code> 함수는 액터의 메일박스에 메시지를 담습니다. 다른 점은, <code>query</code> 함수는 가상의 액터를 생성해서 (송신자로 참조해서) 메시지를 보내는 것입니다. 이때 이 가상 액터가 응답 메시지를 받으면 <code>query</code> 함수에서 리턴된 Promise에 값이 들어갑니다.</p>\\n<p><code>query</code> 함수는 대상 액터 참조, 메시지와 더불어 timeout 값을 인자로 받습니다. timeout 값의 단위는 밀리 초입니다. 만약 Promise에 값이 들\\b어오는데 이보다 시간이 오래 걸리면, 시간 초과와 함께 Promise는 무효화됩니다. 질의 패턴에서의 시간 제한은 운영 환경에서 매우 중요합니다. 서브 시스템의 실패로 인해 질의가 처리되지 못하게 되면 점점 시스템의 가용 자원을 소모하게 되고, 이는 전체 시스템에 단계적으로 장애를 일으키게 됩니다. timeout은 이런 문제가 발생하지 않도록 해줍니다.</p>\\n<p>이 예제에서, 간단한 단일 사용자용 인-메모리 주소록 시스템을 만들어보겠습니다. 실제감을 더하기 위해 express 애플리케이션을 호스팅하겠습니다. npm(혹은 yarn)을 이용해서 <code>express</code>, <code>body-parser</code>, <code>uuid</code> 그리고 <code>nact</code>를 설치합니다.</p>\\n<blockquote>\\n<p>알림: 이 예제는 이후 장에서 계속 확장할 것입니다.</p>\\n</blockquote>\\n<p>주소록 API의 기본 요건이 어떻게 될까요? 다음과 같은 것들이 될 수 있습니다.</p>\\n<ul>\\n<li>새 연락처 추가</li>\\n<li>모든 연락처 조회</li>\\n<li>특정 연락처 조회</li>\\n<li>연락처 수정</li>\\n<li>연락처 삭제</li>\\n</ul>\\n<p>이를 구현하기 위해 다음의 엔드포인트를 구성합니다.</p>\\n<ul>\\n<li>POST /api/contacts - 새 연락처 추가</li>\\n<li>GET /api/contacts - 모든 연락처 조회</li>\\n<li>GET /api/contacts/:contact_id - 특정 연락처 조회</li>\\n<li>PATCH /api/contacts/:contact_id - 연락처 수정</li>\\n<li>DELETE /api/contacts/:contact_id - 연락처 삭제</li>\\n</ul>\\n<p>아래는 서버 인스턴스와 엔드 포인트를 구성하는 미완성 코드입니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code><span class=\\\"token keyword\\\">import</span> express <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'express'</span>\\n<span class=\\\"token keyword\\\">import</span> <span class=\\\"token operator\\\">*</span> <span class=\\\"token keyword\\\">as</span> bodyParser <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'body-parser'</span>\\n\\n<span class=\\\"token keyword\\\">const</span> app <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">express</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">use</span><span class=\\\"token punctuation\\\">(</span>bodyParser<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">json</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 모든 연락처 조회 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 특정 연락처 조회 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">post</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 새 연락처 추가 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">patch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 연락처 수정 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">delete</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token comment\\\">/* 연락처 삭제 */</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">listen</span><span class=\\\"token punctuation\\\">(</span>process<span class=\\\"token punctuation\\\">.</span>env<span class=\\\"token punctuation\\\">.</span>PORT <span class=\\\"token operator\\\">||</span> <span class=\\\"token number\\\">3000</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token template-string\\\"><span class=\\\"token string\\\">`</span><span class=\\\"token interpolation\\\"><span class=\\\"token interpolation-punctuation punctuation\\\">${</span>process<span class=\\\"token punctuation\\\">.</span>env<span class=\\\"token punctuation\\\">.</span>PORT <span class=\\\"token operator\\\">||</span> <span class=\\\"token number\\\">3000</span><span class=\\\"token interpolation-punctuation punctuation\\\">}</span></span><span class=\\\"token string\\\"> 포트 수신중!`</span></span><span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>액터는 메시지 구동 방식으로 동작하므로, 액터 시스템과 REST API 간에 사용할 메시지 타입을 정의합니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code><span class=\\\"token keyword\\\">const</span> ContactProtocolTypes <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span>\\n   GET_CONTACTS<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'GET_CONTACTS'</span><span class=\\\"token punctuation\\\">,</span>\\n   GET_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'GET_CONTACT'</span><span class=\\\"token punctuation\\\">,</span>\\n   UPDATE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'UPDATE_CONTACT'</span><span class=\\\"token punctuation\\\">,</span>\\n   REMOVE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'REMOVE_CONTACT'</span><span class=\\\"token punctuation\\\">,</span>\\n   CREATE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'CREATE_CONTACT'</span><span class=\\\"token punctuation\\\">,</span>\\n   \\n   <span class=\\\"token comment\\\">// 성공</span>\\n   SUCCESS<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'SUCCESS'</span><span class=\\\"token punctuation\\\">,</span>\\n   \\n   <span class=\\\"token comment\\\">// 연락처를 찾지 못했을 때</span>\\n   NOT_FOUND<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token string\\\">'NOT_FOUND'</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>연락처 액터는 각 메시지 타입을 처리해야 합니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code><span class=\\\"token keyword\\\">import</span> <span class=\\\"token punctuation\\\">{</span> v4 <span class=\\\"token keyword\\\">as</span> uuid <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">from</span> <span class=\\\"token string\\\">'uuid'</span>\\n\\n<span class=\\\"token keyword\\\">const</span> contactsService <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">spawn</span><span class=\\\"token punctuation\\\">(</span>\\n  system<span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token punctuation\\\">(</span>state <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token punctuation\\\">}</span> <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">,</span> ctx<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>    \\n    <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>msg<span class=\\\"token punctuation\\\">.</span>type <span class=\\\"token operator\\\">===</span> GET_CONTACTS<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// 모든 연락처를 배열로 반환</span>\\n      <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>\\n        ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> \\n        <span class=\\\"token punctuation\\\">{</span> payload<span class=\\\"token punctuation\\\">:</span> Object<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">values</span><span class=\\\"token punctuation\\\">(</span>state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> \\n        ctx<span class=\\\"token punctuation\\\">.</span>self\\n      <span class=\\\"token punctuation\\\">)</span>\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>msg<span class=\\\"token punctuation\\\">.</span>type <span class=\\\"token operator\\\">===</span> CREATE_CONTACT<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">const</span> newContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> id<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token function\\\">uuid</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">...</span>msg<span class=\\\"token punctuation\\\">.</span>payload <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token keyword\\\">const</span> nextState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> \\n        contacts<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>newContact<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> newContact <span class=\\\"token punctuation\\\">}</span> \\n      <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> newContact <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token keyword\\\">return</span> nextState\\n    <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token comment\\\">// 이미 존재하는 연락처가 있는지 확인</span>\\n      <span class=\\\"token keyword\\\">const</span> contact <span class=\\\"token operator\\\">=</span> state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">[</span>msg<span class=\\\"token punctuation\\\">.</span>contactId<span class=\\\"token punctuation\\\">]</span>\\n\\n      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>contact<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n          <span class=\\\"token keyword\\\">switch</span><span class=\\\"token punctuation\\\">(</span>msg<span class=\\\"token punctuation\\\">.</span>type<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n            <span class=\\\"token keyword\\\">case</span> GET_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n              <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> payload<span class=\\\"token punctuation\\\">:</span> contact<span class=\\\"token punctuation\\\">,</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n              <span class=\\\"token keyword\\\">break</span>\\n            <span class=\\\"token punctuation\\\">}</span>\\n            <span class=\\\"token keyword\\\">case</span> REMOVE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n              <span class=\\\"token comment\\\">// 특정 연락처 항목을 undefined로 변경한 새 상태 반환</span>\\n              <span class=\\\"token keyword\\\">const</span> nextState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> <span class=\\\"token operator\\\">...</span>state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">[</span>contact<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> undefined <span class=\\\"token punctuation\\\">}</span>\\n              <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> contact <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n              <span class=\\\"token keyword\\\">return</span> nextState\\n            <span class=\\\"token punctuation\\\">}</span>\\n            <span class=\\\"token keyword\\\">case</span> UPDATE_CONTACT<span class=\\\"token punctuation\\\">:</span> <span class=\\\"token punctuation\\\">{</span>\\n              <span class=\\\"token comment\\\">// 특정 연락처 항목을 덮어 쓴 새 상태 반환</span>\\n              <span class=\\\"token keyword\\\">const</span> updatedContact <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span><span class=\\\"token operator\\\">...</span>contact<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token operator\\\">...</span>msg<span class=\\\"token punctuation\\\">.</span>payload <span class=\\\"token punctuation\\\">}</span>\\n              <span class=\\\"token keyword\\\">const</span> nextState <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> \\n                <span class=\\\"token operator\\\">...</span>state<span class=\\\"token punctuation\\\">.</span>contacts<span class=\\\"token punctuation\\\">,</span>\\n                <span class=\\\"token punctuation\\\">[</span>contact<span class=\\\"token punctuation\\\">.</span>id<span class=\\\"token punctuation\\\">]</span><span class=\\\"token punctuation\\\">:</span> updatedContact \\n              <span class=\\\"token punctuation\\\">}</span>\\n              <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> SUCCESS<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> updatedContact <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n              <span class=\\\"token keyword\\\">return</span> nextState                 \\n            <span class=\\\"token punctuation\\\">}</span>\\n          <span class=\\\"token punctuation\\\">}</span>\\n      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span>\\n        <span class=\\\"token comment\\\">// 기존 연락처가 존재하지 않으면 NOT_FOUND 메시지를 요청자에게 응답</span>\\n        <span class=\\\"token function\\\">dispatch</span><span class=\\\"token punctuation\\\">(</span>\\n          ctx<span class=\\\"token punctuation\\\">.</span>sender<span class=\\\"token punctuation\\\">,</span> \\n          <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> NOT_FOUND<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">:</span> msg<span class=\\\"token punctuation\\\">.</span>contactId <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> \\n          ctx<span class=\\\"token punctuation\\\">.</span>self\\n        <span class=\\\"token punctuation\\\">)</span>\\n      <span class=\\\"token punctuation\\\">}</span>\\n    <span class=\\\"token punctuation\\\">}</span>      \\n    <span class=\\\"token comment\\\">// 현재 상태에서 변경된 것이 없으면 현재 상태를 그대로 반환</span>\\n    <span class=\\\"token keyword\\\">return</span> state\\n  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span>\\n  <span class=\\\"token string\\\">'contacts'</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>이제 주소록 서비스를 API 컨트롤러와 연결합니다. 각 엔드포인트에서 질의 패턴으로 액터에 메시지를 보냅니다.</p>\\n<p>아래는 특정 연락처를 조회하는 엔드포인트에서 액터와 통신하는 예제입니다. (다른 곳도 비슷하게 합니다.)</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code>app<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span> \\n  <span class=\\\"token keyword\\\">const</span> contactId <span class=\\\"token operator\\\">=</span> req<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">.</span>contact_id\\n  <span class=\\\"token keyword\\\">const</span> msg <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> GET_CONTACT<span class=\\\"token punctuation\\\">,</span> contactId <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">query</span><span class=\\\"token punctuation\\\">(</span>contactService<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">250</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token comment\\\">// 타임아웃 250ms 설정</span>\\n    <span class=\\\"token keyword\\\">switch</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">.</span>type<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">case</span> SUCCESS<span class=\\\"token punctuation\\\">:</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">json</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">.</span>payload<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n      <span class=\\\"token keyword\\\">case</span> NOT_FOUND<span class=\\\"token punctuation\\\">:</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">404</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n      <span class=\\\"token keyword\\\">default</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token comment\\\">// 여기에 도달하지는 않을 것임. 무언가 크게 잘못된 경우</span>\\n        console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">error</span><span class=\\\"token punctuation\\\">(</span>JSON<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">500</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 504: 게이트웨이 시간 초과. 타임아웃이 발생할 때만 예외 던짐</span>\\n    res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">504</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>각 엔드포인트를 구현할 때, 반복되는 보일러 플레이트 코드가 많습니다. <code>performQuery</code>라는 별도의 함수를 만들어서 에러 처리 부분을 따로 빼는 방법으로 코드를 리팩터링 할 수 있습니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code><span class=\\\"token keyword\\\">const</span> performQuery <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">async</span> <span class=\\\"token punctuation\\\">(</span>msg<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> <span class=\\\"token punctuation\\\">{</span>\\n  <span class=\\\"token keyword\\\">try</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token keyword\\\">const</span> result <span class=\\\"token operator\\\">=</span> <span class=\\\"token keyword\\\">await</span> <span class=\\\"token function\\\">query</span><span class=\\\"token punctuation\\\">(</span>contactsService<span class=\\\"token punctuation\\\">,</span> msg<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token number\\\">500</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token comment\\\">// 타임아웃 250ms 설정</span>\\n    \\n    <span class=\\\"token keyword\\\">switch</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">.</span>type<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n      <span class=\\\"token keyword\\\">case</span> SUCCESS<span class=\\\"token punctuation\\\">:</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">json</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">.</span>payload<span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n      <span class=\\\"token keyword\\\">case</span> NOT_FOUND<span class=\\\"token punctuation\\\">:</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">404</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n      <span class=\\\"token keyword\\\">default</span><span class=\\\"token punctuation\\\">:</span>\\n        <span class=\\\"token comment\\\">// 여기에 도달하지는 않을 것임. 무언가 크게 잘못된 경우</span>\\n        console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">error</span><span class=\\\"token punctuation\\\">(</span>JSON<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">stringify</span><span class=\\\"token punctuation\\\">(</span>result<span class=\\\"token punctuation\\\">)</span><span class=\\\"token punctuation\\\">)</span>\\n        res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">500</span><span class=\\\"token punctuation\\\">)</span>\\n        <span class=\\\"token keyword\\\">break</span>\\n    <span class=\\\"token punctuation\\\">}</span>\\n  <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">catch</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token class-name\\\">e</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span>\\n    <span class=\\\"token comment\\\">// 504: 게이트웨이 시간 초과. 타임아웃이 발생할 때만 예외 던짐</span>\\n    res<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">sendStatus</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token number\\\">504</span><span class=\\\"token punctuation\\\">)</span>\\n  <span class=\\\"token punctuation\\\">}</span>\\n<span class=\\\"token punctuation\\\">}</span>\\n</code></pre>\\n      </div>\\n<p>이로써 API 엔드포인트를 아래와 같이 작성할 수 있습니다.</p>\\n<div class=\\\"gatsby-highlight\\\">\\n      <pre class=\\\"language-javascript\\\"><code>app<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> GET_CONTACTS <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">get</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> \\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> GET_CONTACT<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">.</span>contact_id <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">post</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span>\\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> CREATE_CONTACT<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>body <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">patch</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> \\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> UPDATE_CONTACT<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">.</span>contact_id<span class=\\\"token punctuation\\\">,</span> payload<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>body <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n\\napp<span class=\\\"token punctuation\\\">.</span><span class=\\\"token keyword\\\">delete</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'/api/contacts/:contact_id'</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span>req<span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=></span> \\n  <span class=\\\"token function\\\">performQuery</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span> type<span class=\\\"token punctuation\\\">:</span> REMOVE_CONTACT<span class=\\\"token punctuation\\\">,</span> contactId<span class=\\\"token punctuation\\\">:</span> req<span class=\\\"token punctuation\\\">.</span>params<span class=\\\"token punctuation\\\">.</span>contact_id <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">,</span> res<span class=\\\"token punctuation\\\">)</span>\\n<span class=\\\"token punctuation\\\">)</span>\\n</code></pre>\\n      </div>\\n<p>이상으로 간단한 주소록 서비스를 구현해보았습니다.</p>\",\"timeToRead\":4,\"excerpt\":\"액터 시스템은 닫힌 세계가 아니므로 외부 세계와 소통할 수 있어야 합니다. 일반적으로 액터 시스템은 REST API 혹은 RPC를 통해 외부에 노출됩니다. 그런데 REST나 RPC는 블로킹 스타일로 동작합니다. 즉 Request…\",\"frontmatter\":{\"title\":\"질의하기\",\"date\":\"22/03/2019\",\"programming_language\":\"javascript\",\"tags\":[\"getting-started\",\"nact\",\"javascript\",\"nodejs\"]},\"fields\":{\"slug\":\"/질의하기\"}}},\"pathContext\":{\"slug\":\"/질의하기\",\"programming_language\":\"javascript\",\"language\":\"ko_KR\"}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/json-loader!./.cache/json/ko-kr-lesson-javascript-질의하기.json\n// module id = 442\n// module chunks = 193746139245226"],"sourceRoot":""}